

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>&lt;no title&gt; &mdash; BICePs 2.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../../_static/language_data.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> BICePs
          

          
          </a>

          
            
            
              <div class="version">
                2.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../theory.html">Theory</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../workflow.html">Workflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../index.html">Tutorials &amp; Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../biceps.html">API Reference</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">BICePs</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content style-external-links">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
      <li>&lt;no title&gt;</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../../_sources/examples/full_examples/cineromycinB/CineromycinB.ipynb.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container,
div.nbinput.container div.prompt,
div.nbinput.container div.input_area,
div.nbinput.container div[class*=highlight],
div.nbinput.container div[class*=highlight] pre,
div.nboutput.container,
div.nboutput.container div.prompt,
div.nboutput.container div.output_area,
div.nboutput.container div[class*=highlight],
div.nboutput.container div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 250px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    min-width: 5ex;
    padding-top: 0.3rem;
    padding-right: 0.3rem;
    text-align: right;
    flex: 0;
}
@media (max-width: 250px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 250px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    background: #f5f5f5;
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 0.3rem;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="admonition note">
<p>This page was generated from <a class="reference external" href="https://github.com/spatialaudio/nbsphinx/blob/2.0/doc/examples/full_examples/cineromycinB/CineromycinB.ipynb">doc/examples/full_examples/cineromycinB/CineromycinB.ipynb</a>.
Interactive online version:
<span class="raw-html"><a href="https://mybinder.org/v2/gh/spatialaudio/nbsphinx/2.0?filepath=doc/examples/full_examples/cineromycinB/CineromycinB.ipynb"><img alt="Binder badge" src="https://mybinder.org/badge.svg" style="vertical-align:text-bottom"></a></span></p>
</div>
<h1 style="align: center;font-size: 18pt;"><p>Cineromycin B</p>
</h1><!--<img title="https://pubchem.ncbi.nlm.nih.gov" src="https://pubchem.ncbi.nlm.nih.gov/image/imgsrv.fcgi?cid=6444600&t=l" align="center" height="300" width="300">--><hr style="height:2.5px"><h2 style="align: center;font-size: 12pt;"><p>Summary:</p>
</h2><p>In our previous work (DOI: 10.1002/jcc.23738), we determine solution-state conformational populations of the 14-membered macrocycle cineromycin B (O-desmethyl albocycline), using a combination of previously published sparse Nuclear Magnetic Resonance (NMR) observables and replica exchange molecular dynamic/Quantum mechanics (QM)-refined conformational ensembles. Cineromycin B is a 14-membered macrolide antibiotic that has become increasingly known for having activity against
methicillin-resistant Staphylococcus Aureus (MRSA). In this example, we show how to calculate the consistency of computational modeling with experiment, and the relative importance of reference potentials and other model parameters. We will walk through the process of setting up a <code class="docutils literal notranslate"><span class="pre">biceps</span></code> script. You are welcome to take this as a template for you and make necessary modification to get it work for you. All input files used in this tutorial are prepared from this tutorial.</p>
</h2><p><strong>To convert this Jupyter Notebook into a script use the following command:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ jupyter nbconvert --to python cineromycinB.ipynb
</pre></div>
</div>
<hr style="height:2.5px"><p>First, we need to import source code for BICePs classes. More information of these classes can be found <a class="reference external" href="https://biceps.readthedocs.io/en/latest/workflow.html">here</a>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">biceps</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
BICePs - Bayesian Inference of Conformational Populations, Version 2.0
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># What possible experimental data does biceps accept?</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Possible data restraints: {biceps.toolbox.list_possible_restraints()}&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Possible input data extensions: {biceps.toolbox.list_possible_extensions()}&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Possible data restraints: [&#39;Restraint_cs&#39;, &#39;Restraint_J&#39;, &#39;Restraint_noe&#39;, &#39;Restraint_pf&#39;]
Possible input data extensions: [&#39;H&#39;, &#39;Ca&#39;, &#39;N&#39;, &#39;J&#39;, &#39;noe&#39;, &#39;pf&#39;]
</pre></div></div>
</div>
<p>Now we need to specify input files and output files folder.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">####### Data and Output Directories #######</span>
<span class="n">energies</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="s1">&#39;cineromycin_B/cineromycinB_QMenergies.dat&#39;</span><span class="p">)</span><span class="o">*</span><span class="mf">627.509</span>  <span class="c1"># convert from hartrees to kcal/mol</span>
<span class="n">energies</span> <span class="o">=</span> <span class="n">energies</span><span class="o">/</span><span class="mf">0.5959</span>   <span class="c1"># convert to reduced free energies F = f/kT</span>
<span class="n">energies</span> <span class="o">-=</span> <span class="n">energies</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>  <span class="c1"># set ground state to zero, just in case</span>
<span class="n">states</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">energies</span><span class="p">)</span>

<span class="c1"># REQUIRED: specify directory of input data (BICePs readable format)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">biceps</span><span class="o">.</span><span class="n">toolbox</span><span class="o">.</span><span class="n">sort_data</span><span class="p">(</span><span class="s1">&#39;cineromycin_B/J_NOE&#39;</span><span class="p">)</span>

<span class="c1"># REQUIRED: specify outcome directory of BICePs sampling</span>
<span class="n">outdir</span> <span class="o">=</span> <span class="s1">&#39;results&#39;</span>
<span class="c1"># Make a new directory if we have to</span>
<span class="n">biceps</span><span class="o">.</span><span class="n">toolbox</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">outdir</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Next, we need to specify number of steps for BICePs sampling. We recommend to run at least 1M steps for converged Monte Carlo samplings. In BICePs, we also prepare functions of <a class="reference external" href="https://biceps.readthedocs.io/en/latest/examples/Tutorials/Convergence/convergence.html">checking convergence</a> of Monte Carlo. More information can be found <a class="reference external" href="https://biceps.readthedocs.io/en/latest/biceps.html#convergence">here</a>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># REQUIRED: number of MCMC steps for each lambda</span>
<span class="n">nsteps</span> <span class="o">=</span> <span class="mi">10000000</span> <span class="c1"># 10 M steps</span>
</pre></div>
</div>
</div>
<p>We need to specify what lambda values we want to use in BICePs samplings. Briefly, lambda values are similar to the parameters used in free energy perturbation (FEP) and has effect on the BICePs score. The lambda values represent how much prior information from computational modeling is included in BICePs sampling (1.0 means all, 0.0 means none). As we explained in <a class="reference external" href="https://pubs.acs.org/doi/10.1021/acs.jpcb.7b11871">this work</a>, one can consider BICePs score as the relative free energy change
between different models. More lambda values will increase the samplings for <a class="reference external" href="http://www.alchemistry.org/wiki/Multistate_Bennett_Acceptance_Ratio">multistate Bennett acceptance ratio (MBAR)</a> predictions in free energy change and populations. However more lambda values also will slow down the whole process of BICePs (as more samplings need to run), so balancing the accuracy and efficiency is important. To successfully finish a BICePs sampling, lambda values of 0.0 and 1.0 are necessary. Based
on our experience, the lambda values of 0.0,0.5,1.0 are good enough for BICePs sampling.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># REQUIRED: specify how many lambdas to sample (more lambdas will provide higher</span>
<span class="c1"># accuracy but slower the whole process, lambda=0.0 and 1.0 are necessary)</span>
<span class="n">n_lambdas</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">lambda_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">n_lambdas</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">lambda_values</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[0. 1.]
</pre></div></div>
</div>
<p>Print what experimental observables are included in BICePs sampling. This is optional and provides a chance for double check before running BICePs sampling.</p>
<p>In this tutorial, we used both J couplings and NOE (pairwise distances) in BICePs sampling.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># OPTIONAL but RECOMMENDED: print experimental restraints included (a chance for double check)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Input data: {biceps.toolbox.list_extensions(data)}&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Input data: [&#39;J&#39;, &#39;noe&#39;]
</pre></div></div>
</div>
<p>Another key parameter for BICePs set-up is the type of reference potential for each experimental observables. More information of reference potential can be found <a class="reference external" href="https://biceps.readthedocs.io/en/latest/theory.html">here</a>.</p>
<p>Three reference potentials are supported in BICePs: uniform (‘uniform’), exponential (‘exp’), Gaussian (‘gau’).</p>
<p>As we found in previous research, exponential reference potential is useful in most cases. Some higher level task may require more in reference potential selection (e.g <a class="reference external" href="https://pubs.acs.org/doi/10.1021/acs.jpcb.7b11871">force field parametrization</a>).</p>
<p>(Note: It will be helpful to print out what is the order of experimental observables included in BICePs sampling as shown above.)</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># REQUIRED: specify reference potential to use for each experimental observable</span>
<span class="c1"># will be in the same order as the printed observables from (print res)</span>
<span class="n">ref</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;uniform&#39;</span><span class="p">,</span><span class="s1">&#39;exp&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<p>If you want, you can specify nuisance parameters (uncertainty in experiments) range but it’s not required. Our default parameters range is broad enough. “gamma” is a scaling factor converting distances to NOE intensity in experiments. It is only used when NOE restraint is ued in BICePs sampling.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># OPTIONAL: specify nuisance parameters for each experimnetal observable</span>
<span class="c1"># will be in the same order as the printed observables from (print res)</span>
<span class="c1"># only specify if you want to narrow down the default range</span>
<span class="n">uncern</span><span class="o">=</span><span class="p">[[</span><span class="mf">0.05</span><span class="p">,</span><span class="mf">20.0</span><span class="p">,</span><span class="mf">1.02</span><span class="p">],[</span><span class="mf">0.05</span><span class="p">,</span><span class="mf">5.0</span><span class="p">,</span><span class="mf">1.02</span><span class="p">]]</span>
<span class="n">gamma</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.2</span><span class="p">,</span><span class="mf">5.0</span><span class="p">,</span><span class="mf">1.01</span><span class="p">]</span>
</pre></div>
</div>
</div>
<p>Now we need to set up BICePs samplings and feed arguments using variables we defined above. In most cases, you don’t need to modify this part as long as you defined all these parameters shown above.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">####### MCMC Simulations #######</span>
<span class="k">for</span> <span class="n">lam</span> <span class="ow">in</span> <span class="n">lambda_values</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;lambda: </span><span class="si">{lam}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">ensemble</span> <span class="o">=</span> <span class="n">biceps</span><span class="o">.</span><span class="n">Ensemble</span><span class="p">(</span><span class="n">lam</span><span class="p">,</span> <span class="n">energies</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">ensemble</span><span class="o">.</span><span class="n">initialize_restraints</span><span class="p">(</span><span class="n">input_data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">ref_pot</span><span class="o">=</span><span class="n">ref</span><span class="p">,</span>
            <span class="n">uncern</span><span class="o">=</span><span class="n">uncern</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="p">[</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="mf">1.02</span><span class="p">])</span>
    <span class="n">sampler</span> <span class="o">=</span> <span class="n">biceps</span><span class="o">.</span><span class="n">PosteriorSampler</span><span class="p">(</span><span class="n">ensemble</span><span class="o">.</span><span class="n">to_list</span><span class="p">())</span>
    <span class="n">sampler</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">nsteps</span><span class="o">=</span><span class="n">nsteps</span><span class="p">,</span> <span class="n">print_freq</span><span class="o">=</span><span class="mi">1000000</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">sampler</span><span class="o">.</span><span class="n">traj</span><span class="o">.</span><span class="n">process_results</span><span class="p">(</span><span class="n">outdir</span><span class="o">+</span><span class="s1">&#39;/traj_lambda</span><span class="si">%2.2f</span><span class="s1">.npz&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">lam</span><span class="p">))</span>
    <span class="n">outfilename</span> <span class="o">=</span> <span class="s1">&#39;sampler_lambda</span><span class="si">%2.2f</span><span class="s1">.pkl&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">lam</span><span class="p">)</span>
    <span class="n">fout</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">outdir</span><span class="p">,</span> <span class="n">outfilename</span><span class="p">),</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span>
    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">sampler</span><span class="p">,</span> <span class="n">fout</span><span class="p">)</span>
    <span class="n">fout</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;...Done.&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
lambda: 0.0
Step            State   Para Indices            Energy          Acceptance (%)
0               33      [[151], [116, 81]]      119.297         100.00
1000000         87      [[223], [149, 102]]     6.367           71.49
2000000         23      [[251], [144, 105]]     10.597          71.61
3000000         22      [[242], [145, 96]]      8.970           71.56
4000000         21      [[219], [114, 97]]      7.765           71.65
5000000         66      [[280], [131, 97]]      11.077          71.48
6000000         47      [[252], [143, 104]]     11.953          71.31
7000000         45      [[238], [126, 99]]      7.611           71.23
8000000         45      [[250], [124, 95]]      7.041           71.21
9000000         59      [[222], [171, 95]]      14.392          71.15

Accepted 71.14281 %


Accepted [ ...Nuisance paramters..., state] %%
Accepted [32.74304 29.88213 29.88213  8.51764] %

...Done.
lambda: 1.0
Step            State   Para Indices            Energy          Acceptance (%)
0               0       [[150], [116, 81]]      128.034         100.00
1000000         59      [[240], [154, 96]]      7.682           64.13
2000000         39      [[258], [130, 99]]      10.780          64.23
3000000         59      [[236], [143, 93]]      6.438           64.28
4000000         90      [[237], [161, 93]]      9.077           64.29
5000000         85      [[277], [126, 96]]      9.104           64.32
6000000         59      [[302], [111, 95]]      11.312          64.31
7000000         38      [[281], [119, 90]]      7.911           64.30
8000000         90      [[232], [129, 91]]      5.833           64.30
9000000         90      [[248], [128, 88]]      6.561           64.30

Accepted 64.28557 %


Accepted [ ...Nuisance paramters..., state] %%
Accepted [32.72381 29.97256 29.97256  1.5892 ] %

...Done.
</pre></div></div>
</div>
<p><strong>Note that all output trajectories and images will be placed in the previously defined ``outdir`` as ‘results_ref_normal’…</strong></p>
<p><strong>Also note that the user can quickly check to see if our MCMC trajectories have converged using our ``biceps.convergence`` module. See</strong><a class="reference external" href="https://biceps.readthedocs.io/en/latest/examples/Tutorials/Convergence/convergence.html">this tutorial</a><strong>for an example and more details.</strong></p>
<p>Then, we need to run functions in <a class="reference external" href="https://biceps.readthedocs.io/en/latest/biceps.html#analysis">Analysis</a> to get predicted populations of each conformational states and BICePs score. A figure of posterior distribution of populations and nuisance parameters will be plotted as well.</p>
<p>The output files include: population information (“populations.dat”), figure of sampled parameters distribution (“BICePs.pdf”), BICePs score information (“BS.dat”).</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">############ MBAR and Figures ###########</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
<span class="c1"># Let&#39;s do analysis using MBAR algorithm and plot figures</span>
<span class="n">A</span> <span class="o">=</span> <span class="n">biceps</span><span class="o">.</span><span class="n">Analysis</span><span class="p">(</span><span class="n">states</span><span class="o">=</span><span class="n">states</span><span class="p">,</span> <span class="n">resultdir</span><span class="o">=</span><span class="n">outdir</span><span class="p">,</span>
    <span class="n">BSdir</span><span class="o">=</span><span class="s1">&#39;BS.dat&#39;</span><span class="p">,</span> <span class="n">popdir</span><span class="o">=</span><span class="s1">&#39;populations.dat&#39;</span><span class="p">,</span>
    <span class="n">picfile</span><span class="o">=</span><span class="s1">&#39;BICePs.pdf&#39;</span><span class="p">)</span>
<span class="n">A</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Loading results/traj_lambda0.00.npz ...
Loading results/traj_lambda1.00.npz ...
not all state sampled, these states [ 4  5  9 11 13 15 16 22 24 25 26 27 34 40 42 48 51 52 54 62 73 76 77 81
 87 95 98 99] are not sampled
Loading results/sampler_lambda0.00.pkl ...
Loading results/sampler_lambda1.00.pkl ...
lam = [0.0, 1.0]
nstates 100
Writing results/BS.dat...
...Done.
Writing results/populations.dat...
...Done.
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/examples_full_examples_cineromycinB_CineromycinB_21_1.png" src="../../../_images/examples_full_examples_cineromycinB_CineromycinB_21_1.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/examples_full_examples_cineromycinB_CineromycinB_21_2.png" src="../../../_images/examples_full_examples_cineromycinB_CineromycinB_21_2.png" />
</div>
</div>
<p>Now, let’s take a look at the output figure above (“BICePs.pdf”).</p>
<p>The top left panel shows the population of each states in the presence (y-axis) and absense (x-axis) of computational modeling prior information. You can find some states (e.g state 38, 59) get awarded after including computational prior information. If you check <a class="reference external" href="https://onlinelibrary.wiley.com/doi/full/10.1002/jcc.23738">this work</a> you will see how misleading the results will be if we only use experimental restraints without computational prior information. The other three panels show the
distribution of nuisance parameters in the presence or absence of computational modeling information. It may not be clear in this example due to the limit of finite sampling, but based on our experience, including prior information from our simulations will lower the nuisance parameters than only using experimental restraints.</p>
<p>Next, let’s take a look at the populations file.</p>
<p>There are 100 rows corresponding to 100 clustered states. Four columns corresponding to populations of each state (row) for 2 lambda values (first 2 columns) and population change (last 2 columns).</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="n">pops</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">outdir</span><span class="o">+</span><span class="s1">&#39;/populations.dat&#39;</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">pops</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
           0             1         2             3
0   0.017158  2.203805e-05  0.000410  5.357668e-07
1   0.003782  8.038469e-06  0.000194  4.136070e-07
2   0.007418  7.816113e-04  0.000258  2.737407e-05
3   0.000565  5.318498e-06  0.000075  7.046287e-07
4   0.000310  9.283943e-08  0.000056  1.667566e-08
..       ...           ...       ...           ...
95  0.005040  9.690027e-12  0.000224           NaN
96  0.003080  1.964245e-05  0.000175  1.117146e-06
97  0.003802  8.110902e-06  0.000194  4.162408e-07
98  0.003290  3.403677e-11  0.000181  1.164153e-10
99  0.001730  3.172908e-07  0.000131  2.414103e-08

[100 rows x 4 columns]
</pre></div></div>
</div>
<h6 style="align: justify;font-size: 12pt"><p># NOTE: The following cell is for pretty notebook rendering</p>
</h6><div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">IPython.core.display</span> <span class="kn">import</span> <span class="n">HTML</span>
<span class="k">def</span> <span class="nf">css_styling</span><span class="p">():</span>
    <span class="n">styles</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;../../theme.css&quot;</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">HTML</span><span class="p">(</span><span class="n">styles</span><span class="p">)</span>
<span class="n">css_styling</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<style>
    @font-face {
        font-family: "Computer Modern";
        src: url('http://mirrors.ctan.org/fonts/cm-unicode/fonts/otf/cmunss.otf');
    }
    #notebook { /* centers the page content */
    padding-left:8%;
    padding-right:9%;
    }
    #ipython-main-app {
        position: relative;
    }
    #jupyter-main-app {
        position: relative;
    }
    div.cell{
        width:98%;
        margin-left:4% !important;*/
        margin-right:4%;
    }
    h1 {
        font-family: "Charis SIL", Palatino, serif;
        text-align: center;
    }
    h4{
        margin-top:12px;
        margin-bottom: 3px;
       }
    div.text_cell_render{
        font-family: Computer Modern, "Helvetica Neue", Arial, Helvetica, Geneva, sans-serif;
        line-height: 145%;
        font-size: 12pt;
        width:99%;
        margin-left:auto;
        margin-right:auto;
    }
    .output_png {
        display: block;/*table-cell;*/
        text-align: center;
        align: center;
        vertical-align: middle;
        margin-left: auto;
        margin-right: auto;
        width: 100%;
    }
    div.output_area pre {font-weight: normal; text-align: justify; }
    .warning{
        color: rgb( 240, 20, 20 )
        }
    .CodeMirror{
            font-family: "Source Code Pro", source-code-pro,Consolas, monospace;
    }
    .prompt{
        display: None;
    }
    .text_cell_render h5 {
        font-weight: 300;
        font-size: 16pt;
        color: #4057A1;
        font-style: italic;
        margin-bottom: .5em;
        margin-top: 0.5em;
        display: block;
    }
    /* override table width restrictions as found on https://github.com/getpelican/pelican/issues/1311 */
    .wy-table-responsive table td, .wy-table-responsive table th {
        /* !important prevents the common CSS stylesheets from
           overriding this as on RTD they are loaded after this stylesheet */
        white-space: normal !important;
    }

    .wy-table-responsive {
        overflow: visible !important;
    }
</style>

<!-- MathJax configuration -->
<script type="text/x-mathjax-config">
    src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
    MathJax.Hub.Config({
                        TeX: {
                           extensions: ["AMSmath.js"]
                           },
                tex2jax: {
                    inlineMath: [ ['$','$'], ["\\(","\\)"] ],
                    displayMath: [ ['$$','$$'], ["\\[","\\]"] ]
                },
                displayAlign: 'center', // Change this to 'center' to center equations.
                "HTML-CSS": {
                    styles: {'.MathJax_Display': {"margin": 4}},
                    linebreaks: { automatic: true }}
        });
</script></div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Temple University, Yunhui Ge, Robert M. Raddi, Vincent A. Voelz



    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>